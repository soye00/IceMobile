{% extends 'layout.html' %}
{% block style %}
<link rel="stylesheet" href="/css/signup.css">
{% endblock %}
{% block content %}
<div class="container">
    <div class="signup-header">
        <span><a href="/"><i class="bi bi-chevron-left"></i></a></span>
        <span class="signup-title">회원가입</span>
        <span> </span>
    </div>

    <img src="/images/colorlogo.png" alt="Logo" class="logo">

    <div id="progress-container" class="progress-container p-3">
      
      <div class="progress px-1" style="height: 3px;">
        <div class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
      </div>
      <div class="step-container d-flex justify-content-between">
        <div class="step-circle active" onclick="displayStep(1)">1</div>
        <div class="step-circle" onclick="displayStep(2)">2</div>
        <div class="step-circle" onclick="displayStep(3)">3</div>
      </div>

    </div> <!-- progress-container -->

    <form id="multi-step-form" class="p-3 mb-5">
      
      <!-- Step 1: 약관동의 -->
      <div class="step step-1">
        <div class="step-description">약관동의</div>

        <div class="mb-3">
          <label class="form-label">아이스케어 서비스<br/> 이용약관에 동의해주세요.</label>          
        </div>

        <div class="terms-container">
          <div class="all-terms-check" id="all-terms-check">
            <div class="terms-check">
              <i class="bi bi-check"></i>
            </div>
            <span>모든 약관에 동의합니다.</span>
          </div>

          <div class="terms-item">
            <div class="terms-header">
              <div class="terms-check">
                <i class="bi bi-check"></i>
              </div>
              <div class="terms-title">
                <span>서비스 이용약관 동의</span>
                <i class="bi bi-chevron-right"></i>
              </div>
            </div>
            <div class="terms-content">
              본 약관은 제빙기 청소 예약 서비스 이용에 관한 기본적인 조건을 규정합니다. 
              이용자의 권리 및 의무, 서비스 제공 범위, 예약 변경 및 취소 규정 등이 포함되어 있으며, 
              서비스 이용 시 반드시 숙지하셔야 합니다.
            </div>
          </div>

          <div class="terms-item">
            <div class="terms-header">
              <div class="terms-check">
                <i class="bi bi-check"></i>
              </div>
              <div class="terms-title">
                <span>개인정보 수집 및 이용 동의</span>
                <i class="bi bi-chevron-right"></i>
              </div>
            </div>
            <div class="terms-content">
              고객 식별 및 서비스 제공을 위해 이름, 연락처, 주소 등 최소한의 개인정보를 수집합니다. 
              수집된 정보는 예약 처리와 고객 응대를 위해 사용되며, 관련 법령에 따라 안전하게 보호됩니다.
            </div>
          </div>

          <div class="terms-item">
            <div class="terms-header">
              <div class="terms-check">
                <i class="bi bi-check"></i>
              </div>
              <div class="terms-title">
                <span>개인정보 제3자 제공 동의</span>
                <i class="bi bi-chevron-right"></i>
              </div>
            </div>
            <div class="terms-content">
              청소 기사에게 고객의 이름, 연락처, 주소 등을 제공할 수 있습니다.
              제공된 정보는 오직 서비스 수행 목적에 한해 사용되며, 관계 법령에 따라 안전하게 처리됩니다.
            </div>
          </div>

          <div class="terms-item">
            <div class="terms-header">
              <div class="terms-check">
                <i class="bi bi-check"></i>
              </div>
              <div class="terms-title">
                <span>위치 및 개인정보 활용 동의</span>
                <i class="bi bi-chevron-right"></i>
              </div>
            </div>
            <div class="terms-content">
              정확한 예약 및 기사 배정을 위해 위치 및 주소 정보를 수집·활용합니다. 
              수집된 정보는 서비스 제공 목적에 한해 사용되며, 외부에 공유되지 않고 관련 법령에 따라 보호됩니다.
              수집된 정보는 청소 예정일 알림, 할인 쿠폰, 프로모션 및 이벤트 안내를 알림을 위해 사용될 수 있습니다.
            </div>
          </div>
        </div>
      </div>

      <!-- Step 2: 회원가입 -->
      <div class="step step-2" style="display: none;">
        <div class="step-description">회원 정보를 입력해 주세요.</div>
        <div class="mb-3">
          <label for="name" class="form-label">이름</label>
          <input type="text" class="form-control" id="name" name="name" required>
        </div>
        <div class="mb-3">
          <label for="phone" class="form-label">연락처</label>
          <input type="tel" class="form-control" id="phone" name="phone" required>
        </div>
        <div class="mb-3">
          <label for="email" class="form-label">이메일</label>
          <input type="email" class="form-control" id="email" name="email" required>
        </div>
        <div class="mb-3">
          <label for="password" class="form-label">비밀번호</label>
          <input type="password" class="form-control" id="password" name="password" required>
        </div>
        <div class="mb-3">
          <label for="password" class="form-label">비밀번호 확인</label>
          <input type="password" class="form-control" id="password" name="password" required>
        </div>
        <div class="mb-3">
          <label for="address" class="form-label">주소</label>
          <div class="row g-2">
            <div class="col-9">
              <input type="text" class="form-control" id="postcode" name="postcode"  readonly>
            </div>
            <div class="col-3">
              <button type="button" class="btn btn-primary w-100" onclick="openAddressSearch()">검색</button>
            </div>
          </div>
          <input type="text" class="form-control mt-2" id="address" name="address" readonly>
          <input type="text" class="form-control mt-2" id="address_detail" name="address_detail" placeholder="상세주소">
        </div>
        <div class="mb-3">
          <label for="company_no" class="form-label">사업자 번호</label>
          <input type="text" class="form-control" id="company_no" name="company_no" required>
        </div>
      </div>

      <!-- Step 3: 가입완료 -->
      <div class="step step-3" style="display: none;">
        <div class="step-description">가입이 완료되었습니다!</div>
        <div class="text-center mb-3">
          <p>환영합니다! 지금 로그인하여 서비스를 이용해 보세요.</p>
          <a href="/" class="btn btn-success">로그인 하러 가기</a>
        </div>
      </div>
    </form>  <!-- multi-step-form -->

    <div class="btn-container">
      <button type="button" class="btn btn-outline-primary prev-step" style="display: none;">이전</button>
      <button type="button" class="btn btn-primary next-step">다음</button>
    </div>  <!-- btn-container -->
    
</div> <!-- container -->
{% endblock %}
{% block script %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
var currentStep = 1;

// 카카오 주소
function openAddressSearch() {
  new daum.Postcode({
    oncomplete: function(data) {
      document.querySelector('input[name="postcode"]').value = data.zonecode;
      document.querySelector('input[name="address"]').value = data.address;
      document.querySelector('input[name="address_detail"]').focus();
    }
  }).open();
}

function displayStep(stepNumber) {
  if (stepNumber >= 1 && stepNumber <= 3) {
    $(".step").hide();
    $(".step-" + stepNumber).show();
    currentStep = stepNumber;
    updateProgressBar();
    updateStepCircles();
    updateButtons();
  }
}

function updateStepCircles() {
  $(".step-circle").removeClass("active");
  $(".step-circle").eq(currentStep - 1).addClass("active");
}

function updateProgressBar() {
  var progressPercentage = ((currentStep - 1) / 2) * 100;
  $(".progress-bar").css("width", progressPercentage + "%");
}

function updateButtons() {
  if (currentStep === 1) {
    $(".prev-step").hide();
    $(".next-step").show().text("다음");
  } else if (currentStep === 2) {
    $(".prev-step").show();
    $(".next-step").show().text("다음");
  } else if (currentStep === 3) {
    $(".prev-step").show();
    $(".next-step").hide();
  }
}

$(document).ready(function() {
  $(".step").slice(1).hide();
  updateStepCircles();
  updateButtons();

  $(".next-step").click(function() {
    // 유효성 검사
    if (currentStep === 1) {
      const allTermsChecked = $('#all-terms-check .terms-check').hasClass('checked');
      if (!allTermsChecked) {
        alert("약관에 동의해 주세요.");
        return;
      }
    }
    // step 2 유효성 검사 추가해야함 !
    if (currentStep < 3) {
      $(".step-" + currentStep).addClass("animate__animated animate__fadeOutLeft");
      currentStep++;
      setTimeout(function() {
        $(".step").removeClass("animate__animated animate__fadeOutLeft").hide();
        $(".step-" + currentStep).show().addClass("animate__animated animate__fadeInRight");
        updateProgressBar();
        updateStepCircles();
        updateButtons();
      }, 500);
    }
  });

  $(".prev-step").click(function() {
    if (currentStep > 1) {
      $(".step-" + currentStep).addClass("animate__animated animate__fadeOutRight");
      currentStep--;
      setTimeout(function() {
        $(".step").removeClass("animate__animated animate__fadeOutRight").hide();
        $(".step-" + currentStep).show().addClass("animate__animated animate__fadeInLeft");
        updateProgressBar();
        updateStepCircles();
        updateButtons();
      }, 500);
    }
  });

  $('.terms-title').click(function() {
    const $termsItem = $(this).closest('.terms-item');
    const $check = $termsItem.find('.terms-check');
    $check.toggleClass('checked');
    updateAllTermsCheck();
  });

  $('.terms-check').click(function(e) {
    e.stopPropagation();
    const $termsItem = $(this).closest('.terms-item');
    const $check = $termsItem.find('.terms-check');
    $check.toggleClass('checked');
    updateAllTermsCheck();
  });

  $('.bi-chevron-right, .bi-chevron-down').click(function(e) {
    e.stopPropagation();
    const $termsItem = $(this).closest('.terms-item');
    const $content = $termsItem.find('.terms-content');
    const $chevron = $(this);
    
    $content.toggleClass('show');
    $chevron.toggleClass('bi-chevron-right bi-chevron-down');
  });

  $('#all-terms-check').click(function() {
    const $allCheck = $(this);
    const isChecked = !$allCheck.hasClass('checked');
    
    $allCheck.toggleClass('checked');
    $('.terms-check').toggleClass('checked', isChecked);
  });

  function updateAllTermsCheck() {
    const allChecked = $('.terms-item .terms-check').length === $('.terms-item .terms-check.checked').length;
    $('#all-terms-check .terms-check').toggleClass('checked', allChecked);
  }
});
</script>
{% endblock %}