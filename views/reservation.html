{% extends 'layout.html' %}
{% block style %}
<style>
.signup-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
}
.signup-title {
    font-size: 1.2rem;
    font-weight: bold;
}
.signup-header a {
  color: #000;
  font-weight: bold;
}
</style>
{% endblock %}
{% block content %}
<div class="container">
    <div class="signup-header">
        <span><a href="/home"><i class="bi bi-chevron-left"></i></a></span>
        <span class="signup-title">예약하기</span>
        <span> </span>
    </div>

    {% if error %}
      <div class="alert alert-danger">{{ error }}</div>
    {% endif %}
    <form id="reservation-form" action="/reservation" method="post" class="p-3 mb-5">
      <div class="mb-3">
        <label for="name" class="form-label">이름</label>
        <input type="text" class="form-control" id="name" name="name" value="{{ user.name }}" readonly>
        <div id="name-guide" class="form-text" style="display:none; color:#007bff;">이름은 내정보에서 수정 가능합니다.</div>
      </div>
      <div class="mb-3">
        <label for="phone" class="form-label">연락처</label>
        <input type="text" class="form-control" id="phone" name="phone" value="{{ user.phone }}" readonly>
        <div id="phone-guide" class="form-text" style="display:none; color:#007bff;">연락처는 내정보에서 수정 가능합니다.</div>
      </div>
      <div class="mb-3">
        <label for="email" class="form-label">이메일</label>
        <input type="email" class="form-control" id="email" name="email" value="{{ user.email }}" readonly>
        <div id="email-guide" class="form-text" style="display:none; color:#007bff;">이메일은 내정보에서 수정 가능합니다.</div>
      </div>
      <div class="mb-3">
        <label for="address" class="form-label">주소</label>
        <div class="row g-2">
          <div class="col-9">
            <input type="text" class="form-control" id="postcode" name="postcode" value="{{ user.postcode }}" readonly>
          </div>
          <div class="col-3">
            <button type="button" class="btn btn-primary w-100" onclick="openAddressSearch()">검색</button>
          </div>
          <div>
            <input type="text" class="form-control" id="address" name="address" value="{{ user.address }}" readonly>
          </div>
        </div>
        <input type="text" class="form-control mt-2" id="address_detail" name="address_detail" value="{{ user.address_detail }}" placeholder="상세주소">
      </div>
      <div class="mb-3">
        <label for="model" class="form-label">모델명</label>
        <input type="text" class="form-control" id="model" name="model" required>
      </div>
      <div class="mb-3">
        <label for="date" class="form-label">날짜</label>
        <input type="date" class="form-control" id="date" name="date" value="" required>
      </div>
      <div class="mb-3">
        <label for="time" class="form-label">시간</label>
        <select class="form-select" id="time" name="time" required>
          <option value="">시간 선택</option>
          <option value="10:00">10:00</option>
          <option value="12:00">12:00</option>
          <option value="14:00">14:00</option>
          <option value="16:00">16:00</option>
        </select>
      </div>
      <div class="mb-3">
        <label for="remark" class="form-label">요청사항</label>
        <textarea class="form-control" id="remark" name="remark" rows="2"></textarea>
      </div>
      <div class="form-check mb-3">
        <input class="form-check-input" type="checkbox" id="agree" name="agree" required>
        <label class="form-check-label" for="agree">
          수집된 사진이 활용되는 것에 동의합니다.
        </label>
      </div>
      <button type="submit" class="btn btn-primary w-100">예약하기</button>
    </form>
    
</div>
{% endblock %}
{% block script %}
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script>
function openAddressSearch() {
  new daum.Postcode({
    oncomplete: function(data) {
      document.getElementById('postcode').value = data.zonecode;
      document.getElementById('address').value = data.address;
      document.getElementById('address_detail').focus();
    }
  }).open();
}
// 오늘 날짜 기본값 및 min/max 설정
window.onload = function() {
  var today = new Date();
  var yyyy = today.getFullYear();
  var mm = String(today.getMonth() + 1).padStart(2, '0');
  var dd = String(today.getDate()).padStart(2, '0');
  var todayStr = yyyy + '-' + mm + '-' + dd;
  document.getElementById('date').value = todayStr;
  document.getElementById('date').min = todayStr;
  // 2달 후 계산
  var maxDate = new Date(today);
  maxDate.setMonth(maxDate.getMonth() + 2);
  var maxyyyy = maxDate.getFullYear();
  var maxmm = String(maxDate.getMonth() + 1).padStart(2, '0');
  var maxdd = String(maxDate.getDate()).padStart(2, '0');
  var maxStr = maxyyyy + '-' + maxmm + '-' + maxdd;
  document.getElementById('date').max = maxStr;
}
// 폼 제출 시 addr 필드 합치기
const form = document.getElementById('reservation-form');
form.onsubmit = function(e) {
  // addr = postcode, address, address_detail 합치기
  const postcode = document.getElementById('postcode').value;
  const address = document.getElementById('address').value;
  const address_detail = document.getElementById('address_detail').value;
  const addr = [postcode, address, address_detail].filter(Boolean).join(', ');
  // addr을 hidden input으로 추가
  let addrInput = document.getElementById('addr-hidden');
  if (!addrInput) {
    addrInput = document.createElement('input');
    addrInput.type = 'hidden';
    addrInput.name = 'addr';
    addrInput.id = 'addr-hidden';
    form.appendChild(addrInput);
  }
  addrInput.value = addr;
}
function showGuide(id) {
  var el = document.getElementById(id);
  el.style.display = 'block';
  setTimeout(function() {
    el.style.display = 'none';
  }, 2000);
}
document.getElementById('name').addEventListener('click', function() {
  showGuide('name-guide');
});
document.getElementById('phone').addEventListener('click', function() {
  showGuide('phone-guide');
});
document.getElementById('email').addEventListener('click', function() {
  showGuide('email-guide');
});
</script>
{% endblock %}