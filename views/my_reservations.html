{% extends 'layout.html' %}
{% block style %}
<style>
.res-card-container{
  padding: 0 1rem;
}  
.res-card {
  border: 1px solid #eee;
  border-radius: 12px;
  padding: 1.2rem 1rem;
  margin-bottom: 1rem;
  box-shadow: 0 2px 8px rgba(0,0,0,0.04);
  cursor: pointer;
  transition: box-shadow 0.2s;
}
.res-card:hover {
  box-shadow: 0 4px 16px rgba(0,0,0,0.10);
}
.res-status {
  font-weight: bold;
  padding: 0.2em 0.7em;
  border-radius: 1em;
  font-size: 0.95em;
  display: inline-block;
}
</style>
{% endblock %}
{% block content %}
<div class="container">
  <div class="signup-header">
    <span><a href="/home"><i class="bi bi-chevron-left"></i></a></span>
    <span class="signup-title">예약조회</span>
    <span> </span>
  </div>

    
  {% if error %}
    <div class="alert alert-danger">{{ error }}</div>
  {% endif %}
  {% if reservations.length == 0 %}
    <div class="text-center text-muted">예약 내역이 없습니다.</div>
  {% endif %}
  {% for r in reservations %}
    {% set stateInfo = {
      '1': { 'text': '신규예약', 'color': '#4CAF50' },
      '2': { 'text': '결제대기', 'color': '#FF9800' },
      '3': { 'text': '결제완료', 'color': '#2196F3' },
      '4': { 'text': '기사배정', 'color': '#9C27B0' },
      '5': { 'text': '청소완료', 'color': '#607D8B' },
      '6': { 'text': '예약취소', 'color': '#F44336' }
    }[r.state|string] or { 'text': '알 수 없음', 'color': '#999999' } %}
    <div class="res-card-container">
      <div class="res-card" onclick="location.href='/reservation/{{ r.res_no }}'">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <div style="font-size:1.1em; font-weight:500;">
            <div class="res-date" data-date="{{ r.date }}"></div>
            <div>예약시간 : {{ r.time }}</div>
          </div>
          <span class="res-status" style="background:{{ stateInfo.color }}; color:#fff;">{{ stateInfo.text }}</span>
        </div>
        <div class="d-flex justify-content-between align-items-center">
          <div>
            {% if r.state >= 3 %}
              결제 완료금액: 
            {% else %}
              결제 예정금액: 
            {% endif %}
            <b>
              {% if r.price %}
                <span class="formatted-price" data-price="{{ r.price }}"></span>원
              {% else %}
                확인중
              {% endif %}
            </b>
          </div>
        </div>
      </div>
  </div>
  {% endfor %}
  
{% include 'partials/footer.html' %}  
</div>
{% endblock %}
{% block script %}
<script>
// 날짜를 'YYYY년 MM월 DD일'로 변환
function formatKoreanDate(dateStr) {
  if (!dateStr) return '';
  var d = new Date(dateStr);
  if (isNaN(d)) return dateStr;
  return d.getFullYear() + '년 ' + (d.getMonth()+1) + '월 ' + d.getDate() + '일';
}
document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.res-date').forEach(function(el) {
    el.textContent = formatKoreanDate(el.getAttribute('data-date'));
  });
  
  // 가격에 쉼표 포맷팅 적용
  document.querySelectorAll('.formatted-price').forEach(function(el) {
    var price = el.getAttribute('data-price');
    if (price) {
      el.textContent = formatNumberWithCommas(price);
    }
  });
});

// 숫자에 쉼표
function formatNumberWithCommas(number) {
  if (typeof number !== "number" && typeof number !== "string") return "";
  return number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}

</script>
{% endblock %} 